apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: filebeat-syslog
  name: filebeat-syslog
  namespace: elk
spec:
  replicas: 1
  selector:
    matchLabels:
      app: filebeat-syslog
  strategy: {}
  template:
    metadata:
      labels:
        app: filebeat-syslog
    spec:
      containers:
      - image: docker.elastic.co/beats/filebeat:8.4.3@sha256:3f1083922f2bbf25f49497ebf2a2cd3511ce2abcddea98e19c305bd248cfa8be
        name: filebeat
        env:
        - name: ELASTICSEARCH_USERNAME
          valueFrom:
            secretKeyRef:
              name: elastic-credentials
              key: username
        - name: ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              name: elastic-credentials
              key: password
        volumeMounts:
        - mountPath: /usr/share/filebeat/filebeat.yml
          name: filebeat-cm
          readOnly: true
          subPath: filebeat.yml
      volumes:
        - name: filebeat-cm
          configMap:
            name: filebeat-syslog
            items:
            - key: "filebeat.yml"
              path: "filebeat.yml"

